<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—ì´ì „íŠ¸ Alpha - ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/chat.css">
    <link rel="stylesheet" href="/css/form.css">
</head>
<style>
    .forgot-tabs {
        display: flex;
        margin-bottom: 20px;
    }

    .tab-button {
        flex: 1;
        padding: 12px 16px;
        background: transparent;
        border: none;
        color: var(--light-300);
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
        border-bottom: 2px solid transparent;
    }

    .tab-button:hover {
        color: var(--light-100);
        border-bottom: 1px solid var(--light-300);
    }

    .tab-button.active {
        border-bottom: 1px solid var(--light-300);
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    .login-footer p {
        margin: 8px 0;
    }

    .white-theme .tab-button {
        color: var(--dark-300);
    }

    .white-theme .tab-button:hover {
        border-bottom: 1px solid var(--dark-300);
    }

    .white-theme .tab-button.active {
        border-bottom: 1px solid var(--dark-300);
    }
</style>
<body>

    <div class="form-container">
        <!-- Theme Toggle Button -->
        <div class="theme-toggle-container">
            <button class="theme-toggle" id="themeToggle">
                <div class="theme-toggle-slider">
                    <span class="theme-icon theme-icon-dark">ğŸŒ™</span>
                    <span class="theme-icon theme-icon-light">â˜€ï¸</span>
                </div>
            </button>
        </div>

        <div class="form-card">
            <div class="form-header">
                <h1 class="form-logo">
                    <img src="/image/mobius-nox.gif" alt="Mobius" class="login-gif-icon" />
                </h1>
                <p class="form-title">ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ ì°¾ìœ¼ì„¸ìš”</p>
            </div>

            <!-- Tab Navigation -->
            <div class="forgot-tabs">
                <button class="tab-button active" id="findIdTab" onclick="showTab('findId')">ì•„ì´ë”” ì°¾ê¸°</button>
                <button class="tab-button" id="findPasswordTab" onclick="showTab('findPassword')">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</button>
            </div>

            <!-- Find ID Form -->
            <div id="findIdForm" class="tab-content active">
                <form class="form-area" id="findIdFormElement">
                    <div class="error-message" id="findIdError"></div>
                    <div class="success-message" id="findIdSuccess" style="display: none;"></div>

                    <div class="form-group">
                        <label for="findIdEmail" class="form-label">ì´ë©”ì¼ ì£¼ì†Œ</label>
                        <input
                            type="email"
                            id="findIdEmail"
                            name="email"
                            class="form-input"
                            placeholder="ë“±ë¡ëœ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                            required
                        />
                        <small class="form-help">ë“±ë¡ ì‹œ ì‚¬ìš©í•œ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì‹œë©´ ì•„ì´ë””ë¥¼ ì•ˆë‚´í•´ë“œë¦½ë‹ˆë‹¤.</small>
                    </div>

                    <button type="submit" class="submit-button" id="findIdButton">
                        <span id="findIdButtonText">ì•„ì´ë”” ì°¾ê¸°</span>
                        <div class="loading-spinner" id="findIdSpinner" style="display: none;"></div>
                    </button>
                </form>
            </div>

            <!-- Find Password Form -->
            <div id="findPasswordForm" class="tab-content">
                <form class="form-area" id="findPasswordFormElement">
                    <div class="error-message" id="findPasswordError"></div>
                    <div class="success-message" id="findPasswordSuccess" style="display: none;"></div>

                    <div class="form-group">
                        <label for="findPasswordUsername" class="form-label">ì•„ì´ë””</label>
                        <input
                            type="text"
                            id="findPasswordUsername"
                            name="username"
                            class="form-input"
                            placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label for="findPasswordEmail" class="form-label">ì´ë©”ì¼ ì£¼ì†Œ</label>
                        <input
                            type="email"
                            id="findPasswordEmail"
                            name="email"
                            class="form-input"
                            placeholder="ë“±ë¡ëœ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                            required
                        />
                        <small class="form-help">ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë°œì†¡í•  ì´ë©”ì¼ ì£¼ì†Œì…ë‹ˆë‹¤.</small>
                    </div>

                    <button type="submit" class="submit-button" id="findPasswordButton">
                        <span id="findPasswordButtonText">ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •</span>
                        <div class="loading-spinner" id="findPasswordSpinner" style="display: none;"></div>
                    </button>
                </form>
            </div>

            <div class="form-footer">
                <p>
                    ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”?
                    <a href="/signup" class="forgot-password">íšŒì›ê°€ì…</a>
                </p>
            </div>
        </div>
    </div>

    <script src="/js/theme-toggle.js"></script>
    <script>
        const loginGifIcon = document.querySelector('.login-gif-icon');

        // í…Œë§ˆ ë³€ê²½ ì‹œ GIF ì•„ì´ì½˜ë„ ì—…ë°ì´íŠ¸
        document.addEventListener('themeChanged', (e) => {
            if (loginGifIcon) {
                loginGifIcon.src = e.detail.theme === 'white' ? '../image/mobius-lux.gif' : '../image/mobius-nox.gif';
            }
        });

        // Tab switching function
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // Show selected tab content
            document.getElementById(tabName + 'Form').classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');

            // Clear messages
            clearMessages();
        }

        function clearMessages() {
            document.querySelectorAll('.error-message, .success-message').forEach(msg => {
                msg.style.display = 'none';
                msg.textContent = '';
            });
        }

        // Find ID Form Handler
        document.getElementById('findIdFormElement').addEventListener('submit', async function(e) {
            e.preventDefault();

            const email = document.getElementById('findIdEmail').value;
            const button = document.getElementById('findIdButton');
            const buttonText = document.getElementById('findIdButtonText');
            const spinner = document.getElementById('findIdSpinner');
            const errorMsg = document.getElementById('findIdError');
            const successMsg = document.getElementById('findIdSuccess');

            // Clear previous messages
            errorMsg.style.display = 'none';
            successMsg.style.display = 'none';

            // Show loading state
            button.disabled = true;
            buttonText.textContent = 'ê²€ìƒ‰ ì¤‘...';
            spinner.style.display = 'inline-block';

            try {
                const response = await fetch('/find-id', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email: email })
                });

                const result = await response.json();

                if (response.ok) {
                    successMsg.textContent = `í•´ë‹¹ ì´ë©”ì¼ë¡œ ë“±ë¡ëœ ì•„ì´ë””ëŠ” "${result.username}" ì…ë‹ˆë‹¤.`;
                    successMsg.style.display = 'block';
                    document.getElementById('findIdFormElement').reset();
                } else {
                    errorMsg.textContent = result.message || 'í•´ë‹¹ ì´ë©”ì¼ë¡œ ë“±ë¡ëœ ê³„ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                    errorMsg.style.display = 'block';
                }
            } catch (error) {
                console.error('Find ID error:', error);
                errorMsg.textContent = 'ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                errorMsg.style.display = 'block';
            } finally {
                // Reset button state
                button.disabled = false;
                buttonText.textContent = 'ì•„ì´ë”” ì°¾ê¸°';
                spinner.style.display = 'none';
            }
        });

        // Find Password Form Handler
        document.getElementById('findPasswordFormElement').addEventListener('submit', async function(e) {
            e.preventDefault();

            const username = document.getElementById('findPasswordUsername').value;
            const email = document.getElementById('findPasswordEmail').value;
            const button = document.getElementById('findPasswordButton');
            const buttonText = document.getElementById('findPasswordButtonText');
            const spinner = document.getElementById('findPasswordSpinner');
            const errorMsg = document.getElementById('findPasswordError');
            const successMsg = document.getElementById('findPasswordSuccess');

            // Clear previous messages
            errorMsg.style.display = 'none';
            successMsg.style.display = 'none';

            // Show loading state
            button.disabled = true;
            buttonText.textContent = 'ì „ì†¡ ì¤‘...';
            spinner.style.display = 'inline-block';

            try {
                const response = await fetch('/reset-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        email: email
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    successMsg.textContent = 'ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ê°€ ì´ë©”ì¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                    successMsg.style.display = 'block';
                    document.getElementById('findPasswordFormElement').reset();
                } else {
                    errorMsg.textContent = result.message || 'ì…ë ¥í•œ ì •ë³´ì™€ ì¼ì¹˜í•˜ëŠ” ê³„ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                    errorMsg.style.display = 'block';
                }
            } catch (error) {
                console.error('Reset password error:', error);
                errorMsg.textContent = 'ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                errorMsg.style.display = 'block';
            } finally {
                // Reset button state
                button.disabled = false;
                buttonText.textContent = 'ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •';
                spinner.style.display = 'none';
            }
        });

        // Enter key handling
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const activeForm = document.querySelector('.tab-content.active form');
                if (activeForm) {
                    const submitButton = activeForm.querySelector('button[type="submit"]');
                    if (submitButton && !submitButton.disabled) {
                        activeForm.dispatchEvent(new Event('submit'));
                    }
                }
            }
        });
    </script>
</body>
</html>