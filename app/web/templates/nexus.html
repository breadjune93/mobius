<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Mobius</title>
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css"/>
        <link rel="stylesheet" href="/css/fragments/modal.css">
        <link rel="stylesheet" href="/css/nexus.css">
    </head>

    <body>
        <header class="header">
            <div class="header-left">
                <div class="header-icon">
                    <img src="/image/mobius-nox.gif" alt="Mobius Agent" />
                </div>
                <h1 class="header-title">Mobius</h1>
            </div>
            <div class="header-controls">
                <button class="header-btn settings-btn" id="setting_btn" title="ÏÑ§Ï†ï">
                    <i class="fa fa-cog"></i>
                </button>
            </div>
        </header>

        <div class="modal-overlay" id="setting_modal">
            <div class="modal-container">
                <div class="modal-header">
                    <h2>ÏÑ§Ï†ï</h2>
                    <button name="close" class="modal-close-btn">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
<!--                <div class="modal-content">-->
<!--                    <div class="setting-section">-->
<!--                        <h3 class="setting-title">ÌÖåÎßà</h3>-->
<!--                        <div class="setting-item">-->
<!--                            <div class="theme-toggle-container">-->
<!--                                <button class="theme-toggle" id="modalThemeToggle">-->
<!--                                    <div class="theme-toggle-slider">-->
<!--                                        <span class="theme-icon theme-icon-dark">üåô</span>-->
<!--                                        <span class="theme-icon theme-icon-light">‚òÄÔ∏è</span>-->
<!--                                    </div>-->
<!--                                </button>-->
<!--                                <span class="theme-toggle-label" id="themeLabel">Îã§ÌÅ¨ Î™®Îìú</span>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->

<!--                    &lt;!&ndash; Logout Section &ndash;&gt;-->
<!--                    <div class="setting-section">-->
<!--                        <div class="setting-item logout-section">-->
<!--                            <button class="logout-btn" id="logoutBtn">-->
<!--                                <i class="fa fa-sign-out-alt"></i>-->
<!--                                Î°úÍ∑∏ÏïÑÏõÉ-->
<!--                            </button>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
                <div class="modal-footer">
                    <button name="close" class="modal-btn modal-btn-secondary">Ï∑®ÏÜå</button>
                    <button name="submit" class="modal-btn modal-btn-primary">Ï†ÄÏû•</button>
                </div>
            </div>
        </div>

        <div class="modal-overlay" id="create_pylon_modal">
            <div class="modal-container">
                <div class="modal-header">
                    <h2>ÌååÏùºÎü∞ ÏÉùÏÑ±</h2>
                    <button name="close" class="modal-close-btn">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                <div class="modal-content">
                    <form name="create-pylon">
                        <div class="form-group">
                            <label for="pylon_title" class="form-label">Ï†úÎ™©</label>
                            <input
                                type="text"
                                id="pylon_title"
                                name="title"
                                class="form-input"
                                placeholder="Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                required
                                maxlength="50"
                            />
                        </div>
                        <div class="form-group">
                            <label for="pylon_description" class="form-label">ÏÑ§Î™Ö</label>
                            <textarea
                                id="pylon_description"
                                name="description"
                                class="form-textarea"
                                placeholder="ÎåÄÌïú Í∞ÑÎã®Ìïú ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                required
                                maxlength="200"
                                rows="3"
                            ></textarea>
                        </div>
                        <div class="form-group">
                            <label for="pylon_type" class="form-label">Ïú†Ìòï</label>
                            <select id="pylon_type" name="type" class="form-select">
                                <option value="general">ÏùºÎ∞ò</option>
                                <option value="plan">ÏûëÏóÖ</option>
                            </select>
                        </div>

                        <div class="modal-footer">
                            <button type="button" name="close" class="modal-btn modal-btn-secondary">Ï∑®ÏÜå</button>
                            <button type="submit" name="create-pylon" class="modal-btn modal-btn-primary">
                                <span>ÏÉùÏÑ±</span>
                                <div class="loading-spinner" style="display: none;"></div>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="modal-overlay" id="edit_pylon_modal">
            <div class="modal-container">
                <div class="modal-header">
                    <h2>ÌååÏùºÎü∞ ÏàòÏ†ï</h2>
                    <button name="close" class="modal-close-btn">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                <div class="modal-content">
                    <form name="edit-pylon">
                        <input type="hidden" id="edit_pylon_id" name="pylon_id" />
                        <div class="form-group">
                            <label for="edit_pylon_title" class="form-label">Ï†úÎ™©</label>
                            <input
                                type="text"
                                id="edit_pylon_title"
                                name="title"
                                class="form-input"
                                placeholder="Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                required
                                maxlength="50"
                            />
                        </div>
                        <div class="form-group">
                            <label for="edit_pylon_description" class="form-label">ÏÑ§Î™Ö</label>
                            <textarea
                                id="edit_pylon_description"
                                name="description"
                                class="form-textarea"
                                placeholder="ÎåÄÌïú Í∞ÑÎã®Ìïú ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                required
                                maxlength="200"
                                rows="3"
                            ></textarea>
                        </div>
                        <div class="form-group">
                            <label for="edit_pylon_type" class="form-label">Ïú†Ìòï</label>
                            <select id="edit_pylon_type" name="goal" class="form-select">
                                <option value="GENERAL">ÏùºÎ∞ò</option>
                                <option value="PLAN">ÏûëÏóÖ</option>
                            </select>
                        </div>

                        <div class="modal-footer">
                            <button type="button" name="close" class="modal-btn modal-btn-secondary">Ï∑®ÏÜå</button>
                            <button type="submit" name="edit-pylon" class="modal-btn modal-btn-primary">
                                <span>ÏàòÏ†ï</span>
                                <div class="loading-spinner" style="display: none;"></div>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="container">
            <!-- Pylon Controls -->
            <div class="title-section">
                <div class="title-left">
                    <div class="title-title">
                        <img src="/image/nexus.png" alt="Nexus Logo" class="nexus-logo" />
                        <h2 class="title-header">ÎÑ•ÏÑúÏä§</h2>
                    </div>
                    <span class="title-total-pylon" id="total_pylon">TOTAL - 0 Pylon</span>
                </div>
                <div class="title-right">
                    <button class="btn btn-primary" id="create_pylon">
                        <i class="fa fa-plus"></i>
                        ÌååÏùºÎü∞ ÏÉùÏÑ±
                    </button>
                    <button class="btn btn-secondary" id="refresh_nexus">
                        <i class="fa fa-sync-alt"></i>
                        ÏÉàÎ°úÍ≥†Ïπ®
                    </button>
                </div>
            </div>

            <!-- Search Area -->
            <div class="search">
                <div class="search-group">
                    <div class="search-box">
                        <input type="text" id="search_pylon" class="search-input" placeholder="Í≤ÄÏÉâ...">
                        <i class="fa fa-search search-icon"></i>
                    </div>
                </div>
            </div>

            <!-- Pylon Area -->
            <div class="pylon" id="pylon_gallery">
<!--                <div class="pylon-group" data-space-id="1" onclick="joinRoom(1)">-->
<!--                    <div class="pylon-cover">-->
<!--                        <img src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=400&h=250&fit=crop&crop=center" alt="Í∞úÎ∞ú ÏÉÅÎã¥">-->
<!--                        <div class="pylon-overlay">-->
<!--                            <div class="unread-badge">-->
<!--                                <i class="fa fa-comment-dots"></i>-->
<!--                                <span>+5</span>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->

<!--                    <div class="pylon-content">-->
<!--                        <div class="pylon-header">-->
<!--                            <h3 class="pylon-title">ÌîÑÎ°úÏ†ùÌä∏ Í∞úÎ∞ú ÏÉÅÎã¥</h3>-->
<!--                            <span class="pylon-type development">Í∞úÎ∞ú</span>-->
<!--                        </div>-->
<!--                        <p class="pylon-description">ReactÏôÄ Node.js ÌîÑÎ°úÏ†ùÌä∏ Í¥ÄÎ†® ÏßàÎ¨∏Í≥º Ìï¥Í≤∞Ï±ÖÏùÑ ÎÖºÏùòÌï©ÎãàÎã§</p>-->
<!--                        <div class="pylon-stats">-->
<!--                            <div class="stat-item">-->
<!--                                <i class="fa fa-user"></i>-->
<!--                                <span>Ïú†Ï†Ä 7Î™Ö</span>-->
<!--                            </div>-->
<!--                            <div class="stat-item">-->
<!--                                <i class="fa fa-layer-group"></i>-->
<!--                                <span>ÏóêÏù¥Ï†ÑÌä∏ 1Î™Ö</span>-->
<!--                            </div>-->
<!--                            <div class="stat-item">-->
<!--                                <i class="fa fa-clock"></i>-->
<!--                                <span>2025-01-15</span>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->

                <div class="empty-state" id="pylon_empty">
                    <div class="empty-icon">
                        <i class="fa fa-place-of-worship"></i>
                    </div>
                    <h3>ÌååÏùºÎü∞Ïù¥ ÏóÜÏäµÎãàÎã§</h3>
                    <p>ÏÉàÎ°úÏö¥ ÌååÏùºÎü∞ÏùÑ ÎßåÎì§Ïñ¥ ÏóêÏù¥Ï†ÑÌä∏ÏôÄ ÎåÄÌôîÎ•º ÏãúÏûëÌï¥Î≥¥ÏÑ∏Ïöî.</p>
                </div>
            </div>
        </div>

<!--        <script src="/js/theme-toggle.js"></script>-->
        <script src="/js/modal.js"></script>
        <script src="/js/common/api.js"></script>
        <script src="/js/pylon-images.js"></script>
        <script>
            const pylonForm = document.querySelector("form[name=create-pylon]")
            const pylonButton = pylonForm.querySelector('button[name=create-pylon]');
            const pylonButtonText = pylonButton.querySelector("span");
            const pylonLoadingSpinner = pylonButton.querySelector(".loading-spinner");

            const editPylonForm = document.querySelector("form[name=edit-pylon]")
            const editPylonButton = editPylonForm.querySelector('button[name=edit-pylon]');
            const editPylonButtonText = editPylonButton.querySelector("span");
            const editPylonLoadingSpinner = editPylonButton.querySelector(".loading-spinner");

            window.pylonCreateModal = new Modal(
                document.querySelector("#create_pylon"),
                document.querySelector("#create_pylon_modal"),
                null
            );

            window.pylonEditModal = new Modal(
                null,
                document.querySelector("#edit_pylon_modal"),
                null
            );

            document.addEventListener("DOMContentLoaded", async function() {
                await getPylons();
            })

            pylonForm.addEventListener("submit", async function(e) {
                e.preventDefault();
                await createPylon();
            })

            editPylonForm.addEventListener("submit", async function(e) {
                e.preventDefault();
                await updatePylon();
            })

            // ÏÉàÎ°úÍ≥†Ïπ® Î≤ÑÌäº
            document.getElementById("refresh_nexus").addEventListener("click", function() {
                location.reload();
            })

            // Í≤ÄÏÉâ Í∏∞Îä•
            document.getElementById("search_pylon").addEventListener("input", function(e) {
                searchPylons(e.target.value);
            })

            async function getPylons() {
                try {
                    const response = await window.api.get('/api/v1/nexus/pylons');
                    const body = await response.body;

                    if (response.status) {
                        const pylons = await body['pylons'];

                        const pylonContainer = document.getElementById('pylon_gallery');
                        const pylonEmpty = document.getElementById('pylon_empty');
                        const totalPylon = document.getElementById('total_pylon');

                        if (pylons && pylons.length > 0) {
                            // Îπà ÏÉÅÌÉú Ïà®Í∏∞Í∏∞
                            pylonEmpty.style.display = 'none';

                            // ÌååÏùºÎü∞ Í∞úÏàò ÏóÖÎç∞Ïù¥Ìä∏
                            totalPylon.textContent = `total - ${pylons.length} Pylon`;

                            // ÌååÏùºÎü∞ Ïπ¥Îìú ÏÉùÏÑ±
                            pylons.forEach(pylon => {
                                const pylonCard = createPylonCard(pylon);
                                pylonContainer.insertBefore(pylonCard, pylonEmpty);
                            });
                        } else {
                            // ÌååÏùºÎü∞Ïù¥ ÏóÜÏúºÎ©¥ Îπà ÏÉÅÌÉú ÌëúÏãú
                            pylonEmpty.style.display = 'block';
                            totalPylon.textContent = 'total - 0 Pylon';
                        }
                    } else {
                        alert(body.detail || 'ÌååÏùºÎü∞ Ï°∞ÌöåÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                    }
                } catch (error) {
                    alert(error.detail || 'PylonÏùÑ Ï°∞ÌöåÌï† Ïàò ÏóÜÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                }
            }

            function createPylonCard(pylon) {
                const pylonGroup = document.createElement('div');
                pylonGroup.className = 'pylon-group';
                pylonGroup.setAttribute('data-space-id', pylon.id);
                pylonGroup.onclick = () => joinPylon(pylon.id);

                // ÌÉÄÏûÖÏóê Îî∞Î•∏ ÌÅ¥ÎûòÏä§ ÏÑ§Ï†ï
                const typeClass = pylon.goal.toLowerCase();
                const typeText = pylon.goal === 'PLAN' ? 'ÏûëÏóÖ' : 'ÏùºÎ∞ò';

                // ÎÇ†Ïßú Ìè¨Îß∑ÌåÖ
                const createdDate = new Date(pylon.created_at).toISOString().split('T')[0];

                pylonGroup.innerHTML = `
                    <div class="pylon-cover">
                        <img src="${pylon.image_url || getRandomPylonImage()}" alt="${pylon.title}">
                        <div class="pylon-overlay">
                            <div class="pylon-actions">
                                <button class="pylon-action-btn edit-btn" onclick="event.stopPropagation(); openEditModal(${pylon.id})" title="ÏàòÏ†ï">
                                    <i class="fa fa-cog"></i>
                                </button>
                                <button class="pylon-action-btn delete-btn" onclick="event.stopPropagation(); deletePylon(${pylon.id})" title="ÏÇ≠Ï†ú">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="pylon-content">
                        <div class="pylon-header">
                            <h3 class="pylon-title">${pylon.title}</h3>
                            <span class="pylon-type ${typeClass}">${typeText}</span>
                        </div>
                        <p class="pylon-description">${pylon.description}</p>
                        <div class="pylon-stats">
                            <div class="stat-item">
                                <i class="fa fa-user"></i>
                                <span>Ïú†Ï†Ä ${pylon.user_count}Î™Ö</span>
                            </div>
                            <div class="stat-item">
                                <i class="fa fa-layer-group"></i>
                                <span>ÏóêÏù¥Ï†ÑÌä∏ ${pylon.agent_count}Î™Ö</span>
                            </div>
                            <div class="stat-item">
                                <i class="fa fa-clock"></i>
                                <span>${createdDate}</span>
                            </div>
                        </div>
                    </div>
                `;

                return pylonGroup;
            }

            function joinPylon(pylonId) {
                window.location.href = `/pylon?id=${pylonId}`;
            }

            async function createPylon() {
                // Ìèº Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
                const formData = new FormData(pylonForm);
                const data = Object.fromEntries(formData.entries());

                // ÎûúÎç§ Ïù¥ÎØ∏ÏßÄ URL Ï∂îÍ∞Ä
                data.image_url = getRandomPylonImage();

                isCompleted(false);

                try {
                    const response = await window.api.post('/api/v1/nexus/pylon', data);
                    console.log("response: ", response);

                    if (response && response.ok) {
                        const result = await response.json();
                        console.log('ÌååÏùºÎü∞ ÏÉùÏÑ± ÏôÑÎ£å:', result);

                        // Î™®Îã¨ Îã´Í∏∞
                        window.pylonCreateModal.close();

                        // Ìèº Ï¥àÍ∏∞Ìôî
                        pylonForm.reset();

                        // ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ®
                        location.reload();

                        alert('ÌååÏùºÎü∞Ïù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.');
                    } else if (response) {
                        const error = await response.json();
                        alert(error.detail || 'ÌååÏùºÎü∞ ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                    }
                } catch (error) {
                    console.error('Pylon creation error:', error);
                    alert('ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞Ìï† Ïàò ÏóÜÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                } finally {
                    isCompleted(true);
                }
            }

            function isCompleted(flag) {
                pylonButton.disabled = !flag;
                pylonButtonText.textContent = !flag ? "Î°úÍ∑∏Ïù∏ Ï§ë..." : "Î°úÍ∑∏Ïù∏";
                pylonLoadingSpinner.style.display = !flag ? "inline-block" : "none";
            }

            function isEditCompleted(flag) {
                editPylonButton.disabled = !flag;
                editPylonButtonText.textContent = !flag ? "ÏàòÏ†ï Ï§ë..." : "ÏàòÏ†ï";
                editPylonLoadingSpinner.style.display = !flag ? "inline-block" : "none";
            }

            async function openEditModal(pylonId) {
                try {
                    const response = await window.api.get(`/api/v1/nexus/pylon/${pylonId}`);

                    if (response && response.ok) {
                        const result = await response.json();
                        const pylon = result.pylon;

                        // ÌèºÏóê Îç∞Ïù¥ÌÑ∞ Ï±ÑÏö∞Í∏∞
                        document.getElementById('edit_pylon_id').value = pylon.id;
                        document.getElementById('edit_pylon_title').value = pylon.title;
                        document.getElementById('edit_pylon_description').value = pylon.description;
                        document.getElementById('edit_pylon_type').value = pylon.goal;

                        // Î™®Îã¨ Ïó¥Í∏∞
                        window.pylonEditModal.open();
                    } else if (response) {
                        const error = await response.json();
                        alert(error.detail || 'ÌååÏùºÎü∞ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
                    }
                } catch (error) {
                    console.error('Failed to load pylon:', error);
                    alert('ÌååÏùºÎü∞ Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                }
            }

            async function updatePylon() {
                const pylonId = document.getElementById('edit_pylon_id').value;
                const formData = new FormData(editPylonForm);
                const data = Object.fromEntries(formData.entries());

                isEditCompleted(false);

                try {
                    const response = await window.api.put(`/api/v1/nexus/pylon/${pylonId}`, data);
                    console.log("response: ", response);

                    if (response && response.ok) {
                        const result = await response.json();

                        // ÌååÏùºÎü∞ ÏàòÏ†ï ÏÑ±Í≥µ
                        console.log('Pylon updated successfully:', result);

                        // Î™®Îã¨ Îã´Í∏∞
                        window.pylonEditModal.close();

                        // Ìèº Ï¥àÍ∏∞Ìôî
                        editPylonForm.reset();

                        // ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ®
                        location.reload();

                        alert('ÌååÏùºÎü∞Ïù¥ ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.');
                    } else if (response) {
                        const error = await response.json();
                        alert(error.detail || 'ÌååÏùºÎü∞ ÏàòÏ†ïÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                    }
                } catch (error) {
                    console.error('Pylon update error:', error);
                    alert('ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞Ìï† Ïàò ÏóÜÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                } finally {
                    isEditCompleted(true);
                }
            }

            async function deletePylon(pylonId) {
                if (!confirm('Ï†ïÎßêÎ°ú Ïù¥ ÌååÏùºÎü∞ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    return;
                }

                try {
                    const response = await window.api.delete(`/api/v1/nexus/pylon/${pylonId}`);
                    console.log("response: ", response);

                    if (response && response.ok) {
                        const result = await response.json();

                        // ÌååÏùºÎü∞ ÏÇ≠Ï†ú ÏÑ±Í≥µ
                        console.log('Pylon deleted successfully:', result);

                        // ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ®
                        location.reload();

                        alert('ÌååÏùºÎü∞Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                    } else if (response) {
                        const error = await response.json();
                        alert(error.detail || 'ÌååÏùºÎü∞ ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                    }
                } catch (error) {
                    console.error('Pylon delete error:', error);
                    alert('ÏÑúÎ≤ÑÏóê Ïó∞Í≤∞Ìï† Ïàò ÏóÜÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                }
            }

            function searchPylons(keyword) {
                const pylonGroups = document.querySelectorAll('.pylon-group');
                const pylonEmpty = document.getElementById('pylon_empty');
                const searchKeyword = keyword.toLowerCase().trim();
                let visibleCount = 0;

                pylonGroups.forEach(group => {
                    const title = group.querySelector('.pylon-title')?.textContent.toLowerCase() || '';
                    const description = group.querySelector('.pylon-description')?.textContent.toLowerCase() || '';

                    if (searchKeyword === '' || title.includes(searchKeyword) || description.includes(searchKeyword)) {
                        group.style.display = '';
                        visibleCount++;
                    } else {
                        group.style.display = 'none';
                    }
                });

                // Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏùÑ Îïå Îπà ÏÉÅÌÉú ÌëúÏãú
                if (visibleCount === 0 && searchKeyword !== '') {
                    pylonEmpty.style.display = 'block';
                    pylonEmpty.querySelector('h3').textContent = 'Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§';
                    pylonEmpty.querySelector('p').textContent = `"${keyword}"Ïóê ÎåÄÌïú Í≤ÄÏÉâ Í≤∞Í≥ºÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.`;
                } else if (visibleCount === 0 && searchKeyword === '') {
                    pylonEmpty.style.display = 'block';
                    pylonEmpty.querySelector('h3').textContent = 'ÌååÏùºÎü∞Ïù¥ ÏóÜÏäµÎãàÎã§';
                    pylonEmpty.querySelector('p').textContent = 'ÏÉàÎ°úÏö¥ ÌååÏùºÎü∞ÏùÑ ÎßåÎì§Ïñ¥ ÏóêÏù¥Ï†ÑÌä∏ÏôÄ ÎåÄÌôîÎ•º ÏãúÏûëÌï¥Î≥¥ÏÑ∏Ïöî.';
                } else {
                    pylonEmpty.style.display = 'none';
                }

                // Ïπ¥Ïö¥Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
                const totalPylon = document.getElementById('total_pylon');
                if (searchKeyword === '') {
                    totalPylon.textContent = `TOTAL - ${pylonGroups.length} Pylon`;
                } else {
                    totalPylon.textContent = `Í≤ÄÏÉâ Í≤∞Í≥º - ${visibleCount} Pylon`;
                }
            }
        </script>
    </body>
</html>