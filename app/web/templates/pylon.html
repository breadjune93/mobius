<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—ì´ì „íŠ¸ Alpha</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/chat.css">
</head>
<body>
        <header class="header">
            <div class="header-left">
                <div class="header-icon">
                    <img src="/image/mobius-nox.gif" alt="Mobius Agent" />
                </div>
                <h1 class="header-title">Mobius</h1>
            </div>
            <div class="header-controls">
                <button class="header-btn settings-btn" id="setting_btn" title="ì„¤ì •">
                    <i class="fa fa-cog"></i>
                </button>
                <button class="header-btn menu-btn" onclick="toggleSidebar()" title="ë©”ë‰´">
                    <i class="fa fa-bars"></i>
                </button>
            </div>
        </header>

    <!-- Sidebar -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>ì—ì´ì „íŠ¸</h2>
            <button class="close-btn" onclick="closeSidebar()" title="ë‹«ê¸°">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
        
        <div class="sidebar-content">
            <!-- New Agent Button -->
            <button class="new-chat-btn" onclick="createNewChat()" title="New ì—ì´ì „íŠ¸">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 5V19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                New ì—ì´ì „íŠ¸
            </button>
            
            <!-- Agent List -->
            <div class="chat-history">
                <h3>ì ìš©ëœ ì—ì´ì „íŠ¸</h3>
                <div class="chat-list" id="chatList">
                    <!-- Agent items will be added here dynamically -->
                    <div class="chat-item active" onclick="selectChat(this)">
                        <div class="chat-title">í˜„ì¬ ì—ì´ì „íŠ¸</div>
                        <div class="chat-preview">í˜„ì¬ ì ìš©ëœ ì—ì´ì „íŠ¸...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
<!--    <div class="modal-overlay" id="settingsModal">-->
<!--        <div class="modal-container">-->
<!--            <div class="modal-header">-->
<!--                <h2>ì„¤ì •</h2>-->
<!--                <button class="modal-close-btn" id="closeSettingsModal">-->
<!--                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">-->
<!--                        <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>-->
<!--                        <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>-->
<!--                    </svg>-->
<!--                </button>-->
<!--            </div>-->

<!--            <div class="modal-content">-->
<!--                &lt;!&ndash; Theme Setting &ndash;&gt;-->
<!--                <div class="setting-section">-->
<!--                    <h3 class="setting-title">í…Œë§ˆ</h3>-->
<!--                    <div class="setting-item">-->
<!--                        <div class="theme-toggle-container">-->
<!--                            <button class="theme-toggle" id="modalThemeToggle">-->
<!--                                <div class="theme-toggle-slider">-->
<!--                                    <span class="theme-icon theme-icon-dark">ğŸŒ™</span>-->
<!--                                    <span class="theme-icon theme-icon-light">â˜€ï¸</span>-->
<!--                                </div>-->
<!--                            </button>-->
<!--                            <span class="theme-toggle-label" id="themeLabel">ë‹¤í¬ ëª¨ë“œ</span>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->

<!--                &lt;!&ndash; Assistant Setting &ndash;&gt;-->
<!--                <div class="setting-section">-->
<!--                    <h3 class="setting-title">AI ì–´ì‹œìŠ¤í„´íŠ¸</h3>-->
<!--                    <div class="setting-item">-->
<!--                        <select class="setting-select" id="assistantSelect">-->
<!--                            <option value="claude">Claude (Anthropic)</option>-->
<!--                            <option value="gpt">GPT (OpenAI)</option>-->
<!--                            <option value="gemini">Gemini (Google)</option>-->
<!--                        </select>-->
<!--                    </div>-->
<!--                </div>-->

<!--                &lt;!&ndash; Chat Mode Setting &ndash;&gt;-->
<!--                <div class="setting-section">-->
<!--                    <h3 class="setting-title">ëŒ€í™” ëª¨ë“œ</h3>-->
<!--                    <div class="setting-item">-->
<!--                        <div class="radio-group">-->
<!--                            <label class="radio-label">-->
<!--                                <input type="radio" name="chatMode" value="plan" id="planMode" checked>-->
<!--                                <span class="radio-custom"></span>-->
<!--                                <span class="radio-text">Plan ëª¨ë“œ</span>-->
<!--                            </label>-->
<!--                            <label class="radio-label">-->
<!--                                <input type="radio" name="chatMode" value="dev" id="devMode">-->
<!--                                <span class="radio-custom"></span>-->
<!--                                <span class="radio-text">Dev ëª¨ë“œ</span>-->
<!--                            </label>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->

<!--                &lt;!&ndash; Logout Section &ndash;&gt;-->
<!--                <div class="setting-section">-->
<!--                    <div class="setting-item logout-section">-->
<!--                        <button class="logout-btn" id="logoutBtn">-->
<!--                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">-->
<!--                                <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>-->
<!--                                <path d="M16 17L21 12L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>-->
<!--                                <path d="M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>-->
<!--                            </svg>-->
<!--                            ë¡œê·¸ì•„ì›ƒ-->
<!--                        </button>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->

<!--            <div class="modal-footer">-->
<!--                <button class="modal-btn modal-btn-secondary" id="cancelSettings">ì·¨ì†Œ</button>-->
<!--                <button class="modal-btn modal-btn-primary" id="saveSettings">ì €ì¥</button>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->

    <div class="content-title-wrapper" id="contentTitleWrapper">
        <div class="content-title">
            <h2 class="pylon-name" id="pylonName">Loading...</h2>
            <p class="pylon-desc" id="pylonDesc"></p>
        </div>
    </div>

    <div class="chat-container scroll"></div>

    <div class="input-container">
        <div class="input-wrapper">
            <label>
                <textarea class="message-input scroll" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" rows="1"></textarea>
            </label>
            <button class="send-button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M7 11L12 6L17 11M12 18V7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.0.0/dist/markdown-it.min.js"></script>
    <script type="application/javascript" src="/js/api-helper.js"></script>
    <script type="application/javascript" src="/js/common/theme-toggle.js"></script>
    <script type="application/javascript" src="/js/settings-modal.js"></script>
    <script type="application/javascript" src="/js/markdown.js"></script>
    <script type="application/javascript" src="/js/messageBox.js"></script>
    <script type="application/javascript" src="/js/common/util.js"></script>
    <script type="application/javascript" src="/js/chat.js"></script>
    <script type="application/javascript" src="/js/common/api.js"></script>
    <script>
        // URLì—ì„œ pylon ID ê°€ì ¸ì˜¤ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const pylonId = urlParams.get('id');

        // í˜ì´ì§€ ë¡œë“œ ì‹œ pylon ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        document.addEventListener("DOMContentLoaded", async function() {
            if (!pylonId) {
                alert('íŒŒì¼ëŸ° IDê°€ ì—†ìŠµë‹ˆë‹¤.');
                window.location.href = '/nexus';
                return;
            }

            try {
                const response = await window.api.get(`/api/v1/nexus/pylon/${pylonId}`);

                if (response && response.ok) {
                    const result = await response.json();
                    const pylon = result.pylon;

                    // íŒŒì¼ëŸ° ì •ë³´ë¥¼ í˜ì´ì§€ì— í‘œì‹œ
                    console.log('Pylon loaded:', pylon);

                    // í—¤ë” íƒ€ì´í‹€ì€ Mobiusë¡œ ê³ ì • (ì—…ë°ì´íŠ¸ í•˜ì§€ ì•ŠìŒ)

                    // Content Title ì˜ì—­ ì—…ë°ì´íŠ¸
                    const pylonName = document.getElementById('pylonName');
                    const pylonDesc = document.getElementById('pylonDesc');
                    if (pylonName) {
                        pylonName.textContent = pylon.title;
                    }
                    if (pylonDesc) {
                        pylonDesc.textContent = pylon.description;
                    }

                    // ì±„íŒ… ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
                    const chatPreview = document.querySelector('.chat-preview');
                    if (chatPreview) {
                        chatPreview.textContent = pylon.description;
                    }

                    // ì „ì—­ ë³€ìˆ˜ë¡œ pylon ì •ë³´ ì €ì¥
                    window.currentPylon = pylon;
                } else if (response) {
                    const error = await response.json();
                    alert(error.detail || 'íŒŒì¼ëŸ° ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    window.location.href = '/nexus';
                }
            } catch (error) {
                console.error('Failed to load pylon:', error);
                alert('íŒŒì¼ëŸ° ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                window.location.href = '/nexus';
            }
        });
    </script>
</body>
</html>